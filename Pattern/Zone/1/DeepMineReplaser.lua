---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 07.03.2020 0:35
---

function MineReplacer()--ужасно, больше так не буду делать, мозголомание бредовое
	local e=nil
	local k=0
	local id=FourCC('e004')--!!!!!
		GroupEnumUnitsInRect(perebor,bj_mapInitialPlayableArea,nil)
		while true do
			e = FirstOfGroup(perebor)
			if e == nil then break end
			if UnitAlive(e) and GetUnitTypeId(e)==id then
				local x,y=GetUnitXY(e)
				KillUnit(e)
				k=k+1
				CreateDeepMine(x,y)
			end
			GroupRemoveUnit(perebor,e)
		end
		--print("Запущено юнитов мин: "..k)
end

function CreateDeepMine(x,y)
	local eff=AddSpecialEffect("Water Mine",x,y)
	BlzSetSpecialEffectZ(eff,-200)
	TimerStart(CreateTimer(), 0.3, true, function()
		local IsContent, hero=PointContentUnit(x,y,100)
		if IsContent and IsUnitZCollision(hero,-90) then
			--UnitDamageArea(hero,100,x,y,100,-90)
			UnitDamageTarget( hero, hero, 100, true, false, ATTACK_TYPE_NORMAL, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS )
			ExplodeEffect(eff,3)
			DestroyTimer(GetExpiredTimer())
			TimerStart(CreateTimer(), 60, false, function()
				CreateDeepMine(x,y)
			end)
		end
	end)
end
