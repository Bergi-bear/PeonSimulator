---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Bergi.
--- DateTime: 07.04.2020 3:02
---
function StartPeonAI(hero)
	--print("Запущен ИИ для "..GetUnitName(hero))
	local data=HERO[GetPlayerId(GetOwningPlayer(hero))]
	data.ReleaseRMB=true
	local LastM=0
	local ErrorTime=0
	local ErrorTime2=0
	local Base=FindUnitOfType(FourCC('o001'))
	local k=1
	TimerStart(CreateTimer(), 1, true, function()
		data.ReleaseW=false
		data.ReleaseA=false
		data.ReleaseS=false
		data.ReleaseD=false

		ErrorTime2=ErrorTime2+1
		local d=GetNearbyDes(hero,500*k)
		--print(GetDestructableName(d))
		local  turn=AngleBetweenXY(GetUnitX(hero),GetUnitY(hero),GetDestructableX(d),GetDestructableY(d))/bj_DEGTORAD
		data.LastTurn=turn--GetRandomReal(0,360)
		local m=DistanceBetweenXY(GetUnitX(hero),GetUnitY(hero),GetDestructableX(d),GetDestructableY(d))


		if ErrorTime==15 then
			ErrorTime=0
		end

		if ErrorTime2==60 then
			ErrorTime2=0
			k=k+1
		end


		if not d or ErrorTime>=10  then --	if not d or ErrorTime>=10  then --
			--print("хз что делать")
			data.LastTurn=GetRandomReal(0,360)
			local fr=GetRandomInt(1,8)
			if fr==1 then
				data.ReleaseW=true
			elseif fr==2 then
				data.ReleaseA=true
			elseif fr==3 then
				data.ReleaseS=true
			elseif fr==4 then
				data.ReleaseD=true
			elseif fr==5 then
				data.ReleaseW=true
				data.ReleaseD=true
			elseif fr==6 then
				data.ReleaseD=true
				data.ReleaseS=true
			elseif fr==7 then
				data.ReleaseS=true
				data.ReleaseA=true
			elseif fr==8 then
				data.ReleaseA=true
				data.ReleaseW=true
			end
		end

		if not data.IsWood then -- нет дерева
			if d then
				ErrorTime=ErrorTime+1
				data.RangeDesMove=m
			end
		else--есть дерево
			--print("Есть дерево, возвращаюсь на базу "..ErrorTime)
			ErrorTime=ErrorTime+1
			data.LastTurn=AngleBetweenXY(GetUnitX(hero),GetUnitY(hero),GetUnitX(Base),GetUnitY(Base))/bj_DEGTORAD
			data.RangeDesMove=DistanceBetweenXY(GetUnitX(hero),GetUnitY(hero),GetUnitX(Base),GetUnitY(Base))
			ErrorTime2=0
			k=1

			if ErrorTime>=13  then --	if not d or ErrorTime>=10  then --
				--print("я застрял, пока нёс дерево")
				data.LastTurn=GetRandomReal(0,360)

				local fr=GetRandomInt(1,8)
				if fr==1 then
					data.ReleaseW=true
				elseif fr==2 then
					data.ReleaseA=true
				elseif fr==3 then
					data.ReleaseS=true
				elseif fr==4 then
					data.ReleaseD=true
				elseif fr==5 then
					data.ReleaseW=true
					data.ReleaseD=true
				elseif fr==6 then
					data.ReleaseD=true
					data.ReleaseS=true
				elseif fr==7 then
					data.ReleaseS=true
					data.ReleaseA=true
				elseif fr==8 then
					data.ReleaseA=true
					data.ReleaseW=true
				end
			end
		end
	end)
end

function GetNearbyDes(hero, range)
	local d=nil
	local x,y=GetUnitXY(hero)
	local this=nil
	SetRect(GlobalRect, x - range, y - range, x + range, y +range)
	EnumDestructablesInRect(GlobalRect,nil,function ()
		d=GetEnumDestructable()
		if GetDestructableLife(d)>0 and GetUnitZ(hero)>=GetTerrainZ(GetDestructableX(d),GetDestructableY(d)) then
			this=d
		end
		if GetDestructableTypeId(d)==FourCC('LTlt') then

		end
	end)
	return this
end